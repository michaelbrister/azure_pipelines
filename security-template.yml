jobs:
  - job: SecurityScan
    steps:
      # ğŸ“¢ Log Security Scan Start
      - script: echo "ğŸ” Starting Security Scans..."

      # ğŸ›¡ Static Code Analysis (SonarQube)
      - task: SonarCloudPrepare@1
        inputs:
          SonarQube: 'SonarQubeConnection'
      - task: SonarCloudAnalyze@1
      - task: SonarCloudPublish@1

      # ğŸ” Dependency Security Scan (Snyk)
      - script: echo "ğŸ” Running Dependency Security Scan..."
      - task: SnykSecurityScan@1 || echo "Security vulnerabilities detected!" > security-log.txt

      # ğŸ— Container Security Scan (Trivy)
      - script: echo "ğŸ›¡ Running Container Security Scan..."
      - task: Trivy@1

      # ğŸ“¢ Log Security Scan Completion
      - script: echo "âœ… Security Scans Completed Successfully!"

      # ğŸš¨ Publish Logs for Vulnerabilities
      - task: PublishBuildArtifacts@1
        condition: failed()
        inputs:
          pathToPublish: security-log.txt
          artifactName: security_failure_logs

      # ğŸ“© Send Alert if Security Issues Found
      - task: SendEmail@1
        condition: failed()
        inputs:
          to: 'security-team@example.com'
          subject: 'ğŸš¨ Security Vulnerability Alert!'
          body: |
            Security scans detected vulnerabilities in the latest build. Immediate review required.

      - task: TeamsNotification@1
        condition: failed()
        inputs:
          teamsWebhookUrl: 'https://outlook.office.com/webhook/...'
          message: |
            ğŸš¨ **Security Vulnerability Alert**  
            - Security issues were detected in the latest scan.  
            - Logs are available for review and remediation.
